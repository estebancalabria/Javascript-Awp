<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Todo List</title>
    <link rel="stylesheet" href="node_modules/bootstrap/dist/css/bootstrap.min.css">

    <script>

        function deleteItem(event){
            const btn = event.target;
            const li = btn.parentElement;
            li.remove();

            //Mostrar mensaje de no hay tareas
            const ul = document.querySelector("ul");
            //El ivisible y agregar el mensaje de no hay tareas 
            if (ul.children.length === 2) {
                const liNoTask = document.getElementById("liNoTask");
                liNoTask.style.display = "block";
            }
        }

        function confirmarEdicion(event){
            const btn = event.target;
            const input = btn.parentElement.querySelector("input");
            const li = btn.parentElement;
            const span = document.createElement("span");
            span.innerText = input.value;
            li.replaceChild(span, input);
            //Remplazo los eventos
            btn.removeEventListener("click", confirmarEdicion);
            btn.addEventListener("click", editarTarea);
            //Vuelvo a ponerle el icono al boton
            btn.innerHTML = "&#9998;";
        }

        function editarTarea(event){
            const btn = event.target;
            const li = btn.parentElement;
            const span = li.querySelector("span");
            //reemplazo el span por un input
            const input = document.createElement("input");
            input.value = span.innerText;
            li.replaceChild(input, span);
            //remplazo el evento del boton por confirmar edicion
            btn.removeEventListener("click", editarTarea);
            btn.addEventListener("click", confirmarEdicion); 
            //Le cambio el icono al boton
            btn.innerText = "âœ”";
        }

        function createNewTaskListItem(task){
            return `
                <li class="list-group-item d-flex justify-content-between align-items-center">
                    <button class="btn btn-primary" onclick='editarTarea(event)'>&#9998;</button>
                    <span>${task}</span>
                    <button class="btn btn-danger" onClick='deleteItem(event)'>&#128465;</button>
                </li>
            `;
        }

        window.addEventListener("load", ()=>{
            const btnAdd = document.getElementById("btnAdd");

            btnAdd.addEventListener("click", ()=>{
                const txtNewTask = document.getElementById("txtNewTask");
                const newTask = txtNewTask.value;
                if (newTask.trim() !== "") {
                    const ul = document.querySelector("ul");

                    //Debe sobrescribir el manejo de eventos de los botones del add
                    //ul.innerHTML += createNewTaskListItem(newTask);

                    ul.insertAdjacentHTML("beforeend", createNewTaskListItem(newTask));
                    txtNewTask.value = "";

                    //Ocultar mensaje de no hay tareas
                    const liNoTask = document.getElementById("liNoTask");
                    liNoTask.style.display = "none";
                }
            })
        })
    </script>
</head>
<body>
    <header class="bg-secondary py-4">
        <h1 class="text-3xl font-bold text-secondary-foreground text-center">AWP Todo List</h1>
    </header>

    <ul class="list-group mx-auto mt-4" style="width: 50%;">
        <li class="list-group-item d-flex justify-content-between align-items-center">
            <input id="txtNewTask" type="text" class="form-control" placeholder="Task">
            <button id="btnAdd" class="btn btn-primary">
                Add
            </button>
        </li>
        <!--Item vacio cuando no nay elementos con mensaje-->
        <li id="liNoTask" class="list-group-item text-center">
            <strong>No hay tareas. Agregue su primer tarea</strong>
        </li>
    </ul>
</body>
</html>